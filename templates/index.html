{% extends "layout.html" %}

{% block title %}Integration Status{% endblock %}

{% block content %}
<div class="row">
    <!-- Firefly III Status -->
    <div class="col-md-6">
        <div class="card mb-4" x-data="fireflyStatus" x-init="checkStatus()">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>Firefly III</span>
                <span class="badge"
                      :class="status === 'ok' ? 'bg-success' : (status === 'fail' ? 'bg-danger' : 'bg-warning')"
                      x-text="status === 'ok' ? 'Connected' : (status === 'fail' ? 'Disconnected' : 'Checking...')">
                </span>
            </div>
            <div class="card-body">
                <template x-if="status === null">
                    <p class="text-muted">
                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                        Checking status...
                    </p>
                </template>
                <template x-if="status === 'ok'">
                    <p class="text-success">Firefly III is properly configured and reachable.</p>
                </template>
                <template x-if="status === 'fail'">
                    <p class="text-danger">
                        Connection failed. Please check configuration.
                        <a href="/configuration" class="btn btn-primary ms-2">Fix Configuration</a>
                    </p>
                </template>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">TrueLayer</div>
            <div class="card-body">
                <p class="text-muted">Status check not implemented yet.</p>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('fireflyStatus', () => ({
            status: null,
            async checkStatus() {
                try {
                    const res = await fetch('/firefly/healthcheck');
                    const data = await res.json();
                    this.status = (res.ok && data.status === 'OK') ? 'ok' : 'fail';
                    console.log('Firefly III status:', this.status);
                } catch (err) {
                    this.status = 'fail';
                    console.error('Error checking Firefly III status:', err);
                }
            }
        }));
    });
</script>
{% endblock %}
